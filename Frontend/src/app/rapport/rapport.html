<div class="annotation-list">
  <!-- Loading state -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Chargement des rapports IA...</p>
  </div>

  <!-- Error state -->
  <div *ngIf="error && !isLoading" class="error-state">
    <p>{{ error }}</p>
    <button (click)="loadRapports()">Réessayer</button>
  </div>

  <!-- Empty state -->
  <div *ngIf="!isLoading && !error && rapports.length === 0" class="empty-state">
    <p>Aucun rapport IA trouvé.</p>
  </div>

  <!-- Rapports list -->
  <div *ngFor="let ann of filteredRapports" class="annotation-card">
    <div class="annotation-content">
      <div *ngIf="ann.annotation?.video" class="annotation-video">
        <div class="video-wrapper"
             (mouseenter)="hoveredVideo = ann"
             (mouseleave)="hoveredVideo = null">
          <video
            [src]="getVideoUrl(ann.annotation?.video)"
            autoplay
            muted
            playsinline
            loop
            width="100%"
            style="width:100%;height:auto;max-width:100%;object-fit:fill;"
            #videoPlayer>
            Votre navigateur ne supporte pas la lecture de vidéos.
          </video>
          <div
            class="custom-controls"
            *ngIf="hoveredVideo === ann"
            (click)="$event.stopPropagation()">
            <button class="play-pause-btn" (click)="togglePlay(videoPlayer)">
              <ng-container *ngIf="videoPlayer.paused; else pauseIcon">
                <!-- Icône Play SVG -->
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="6,4 20,12 6,20 6,4"/></svg>
              </ng-container>
              <ng-template #pauseIcon>
                <!-- Icône Pause SVG -->
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
              </ng-template>
            </button>
            <div class="progress-bar">
              <div class="progress" [style.width.%]="getProgress(videoPlayer)"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="annotation-infos">
        <div class="annotation-header">
          <span class="annotation-type ia-badge">
            <svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' viewBox='0 0 24 24' style='vertical-align:middle;margin-right:4px;'><rect x='2' y='7' width='15' height='10' rx='2' ry='2'/><polygon points='23 7 16 12 23 17 23 7'/></svg>
            IA
          </span>
          <span class="annotation-date">{{ ann.annotation?.date_annotation | date:'dd/MM/yyyy HH:mm' }}</span>
        </div>
        <h3 class="annotation-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none" stroke="#0f172a" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" style="vertical-align:middle;margin-right:7px;"><rect x="2" y="7" width="15" height="10" rx="2" ry="2"/><polygon points="23 7 16 12 23 17 23 7"/></svg>
          {{ ann.annotation_humaine }}
        </h3>
        <div class="annotation-teams">
          <span class="team home team-badge">{{ ann.equipe }}</span>
          <span class="vs">vs</span>
          <span class="team away team-badge">{{ ann.annotation?.visiteuse || 'Adversaire' }}</span>
        </div>
        <div class="annotation-comment highlight">
          <strong>Prédiction IA :</strong> {{ ann.prediction_ia }}
        </div>
        <div class="annotation-comment">
          <strong>Confiance :</strong> {{ (ann.confiance * 100).toFixed(1) }}%
        </div>
        <div class="annotation-comment">
          <strong>Joueurs détectés :</strong> {{ ann.joueurs_detectes.join(', ') }}
        </div>
        <div class="annotation-comment">
          <strong>Commentaire expert :</strong> {{ ann.commentaire_expert }}
        </div>
        <div class="annotation-comment">
          <strong>Validation :</strong> {{ ann.validation }}
        </div>
        <div class="annotation-footer">
          <span class="annotation-coach">Validateur IA : {{ currentUser?.username }}</span>
          <span class="annotation-seq">ID Séquence : {{ ann.id_sequence }}</span>
          <div class="action-buttons">
            <button class="delete-btn" (click)="deleteRapport(ann.id_sequence)" title="Supprimer le rapport IA, l'annotation et la vidéo">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                <polyline points="3,6 5,6 21,6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"/>
                <line x1="10" y1="11" x2="10" y2="17"/>
                <line x1="14" y1="11" x2="14" y2="17"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
