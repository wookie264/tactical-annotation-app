<!-- Header with user info and logout -->
<div class="header">
  <div class="header-content">
    <h1 class="titre-principal">Analyse Tactique Football</h1>
    <div class="user-info">
      <span>Connecté en tant que: {{ currentUser?.username }}</span>
      <button class="logout-btn" (click)="logout()">Déconnexion</button>
    </div>
  </div>
</div>

<div class="bulk-upload-header">
  <button class="back-btn" (click)="goBack()">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
      <polyline points="15,18 9,12 15,6"/>
    </svg>
    Retour
  </button>
</div>

<p class="sous-titre">Analysez vos séquences vidéo avec l'intelligence artificielle</p>

<!-- Main Content Layout -->
<div class="app-main-layout">
  <!-- Video Upload Card -->
  <div class="video-upload-card">
    <div class="video-upload-header">
      <h2 class="video-upload-title">
        <span class="video-upload-title-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" stroke="#222" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 48 48" style="vertical-align:middle;">
            <path d="M24 32V12"/>
            <path d="M16 20l8-8 8 8"/>
            <path d="M8 36v2a2 2 0 0 0 2 2h28a2 2 0 0 0 2-2v-2"/>
          </svg>
        </span>
        Séquence Vidéo
      </h2>
      <p class="video-upload-subtitle">Uploadez une séquence de 3-7 secondes</p>
    </div>
    
    <!-- Upload Status Messages -->
    <div *ngIf="isUploading" class="upload-status uploading">
      <p>Upload en cours...</p>
    </div>
    
    <div *ngIf="uploadError" class="upload-status error">
      <p>{{ uploadError }}</p>
    </div>
    
    <div *ngIf="uploadSuccess && uploadedVideo" class="upload-status success">
      <p>✅ Vidéo uploadée avec succès!</p>
      <p *ngIf="uploadedVideo.filename">Fichier: {{ uploadedVideo.filename }}</p>
    </div>

    <!-- Video Preview Section -->
    <div *ngIf="videoPreviewUrl && selectedFile" class="video-preview-section">
      <div class="video-preview-header">
        <h3>Aperçu de la vidéo</h3>
        <p class="file-info">{{ fileName }}</p>
      </div>
      
      <div class="video-player-container">
        <video 
          class="video-preview-player" 
          [src]="videoPreviewUrl" 
          controls 
          preload="metadata"
          width="100%"
          height="auto">
          Votre navigateur ne supporte pas la lecture de vidéos.
        </video>
      </div>
      
      <div class="video-actions">
        <button 
          type="button" 
          class="btn btn-primary upload-btn" 
          (click)="uploadVideo()" 
          [disabled]="isUploadDisabled()">
          <span *ngIf="!isUploading">Uploader la vidéo</span>
          <span *ngIf="isUploading">Upload en cours...</span>
        </button>
        
        <button 
          type="button" 
          class="btn btn-secondary cancel-btn" 
          (click)="cancelUpload()" 
          [disabled]="isUploading">
          Annuler
        </button>
      </div>
    </div>

    <!-- File Selection Dropzone (only show when no video is selected) -->
    <label *ngIf="!selectedFile" class="video-upload-dropzone" [class.disabled]="isUploading">
      <input type="file" accept="video/*" class="video-upload-input" (change)="onFileSelected($event)" [disabled]="isUploading">
      <span class="video-upload-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" stroke="#94a3b8" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 48 48">
          <path d="M24 32V12"/>
          <path d="M16 20l8-8 8 8"/>
          <path d="M8 36v2a2 2 0 0 0 2 2h28a2 2 0 0 0 2-2v-2"/>
        </svg>
      </span>
      <span class="video-upload-text">
        {{ isUploading ? 'Upload en cours...' : 'Cliquez pour sélectionner une vidéo' }}
      </span>
    </label>
  </div>

  <!-- AI Analysis Card -->
  <div class="tactical-annotation-card">
    <div class="tactical-annotation-header">
      <h2 class="tactical-annotation-title">
        <span class="tactical-annotation-title-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" stroke="#222" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 48 48" style="vertical-align:middle;">
            <path d="M9 12l2 2 4-4"/>
            <path d="M21 12c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
            <path d="M3 6h18l2 12H5L3 6z"/>
          </svg>
        </span>
        Analyse IA
      </h2>
      <p class="tactical-annotation-subtitle">Générez un rapport d'analyse automatique</p>
    </div>

    <div class="tactical-annotation-content">
      <div *ngIf="!uploadedVideo" class="analysis-placeholder">
        <div class="placeholder-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="none" stroke="#cbd5e1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 48 48">
            <rect x="2" y="7" width="15" height="10" rx="2" ry="2"/>
            <polygon points="23 7 16 12 23 17 23 7"/>
          </svg>
        </div>
        <h3>Prêt pour l'analyse</h3>
        <p>Uploadez d'abord une vidéo pour commencer l'analyse IA</p>
      </div>

      <div *ngIf="uploadedVideo" class="analysis-ready">
        <div class="analysis-status">
          <div class="status-icon success">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
              <polyline points="22,4 12,14.01 9,11.01"/>
            </svg>
          </div>
          <div class="status-content">
            <h3>Vidéo prête pour analyse</h3>
            <p>{{ uploadedVideo.filename }}</p>
          </div>
        </div>

        <div class="analysis-actions">
          <button 
            class="btn btn-primary btn-large predict-btn" 
            (click)="triggerPrediction()" 
            [disabled]="!uploadedVideo">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" style="margin-right: 8px;">
              <rect x="2" y="7" width="15" height="10" rx="2" ry="2"/>
              <polygon points="23 7 16 12 23 17 23 7"/>
            </svg>
            Analyser IA (Rapport)
          </button>
        </div>

        <div class="analysis-info">
          <h4>Ce que l'analyse IA va faire :</h4>
          <ul>
            <li>Détecter automatiquement les joueurs et leurs positions</li>
            <li>Analyser les mouvements tactiques</li>
            <li>Générer un rapport détaillé</li>
            <li>Identifier les schémas de jeu</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
