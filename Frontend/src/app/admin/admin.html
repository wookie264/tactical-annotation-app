<!-- Header with user info and logout -->
<div class="header">
  <div class="header-content">
    <h1 class="titre-principal">Analyse Tactique Football</h1>
    <div class="user-info">
      <span>Connecté en tant que: {{ currentUser?.username }}</span>
      <button class="logout-btn" (click)="logout()">Déconnexion</button>
    </div>
  </div>
</div>

<div *ngIf="showToast" [class]="toastError ? 'custom-toast error' : 'custom-toast'">
  {{ toastMessage }}
</div>

<div class="admin-container">
  <!-- Message d'accueil -->
  <div class="welcome-message">
    <h2 id="titre-bienvenue" [ngStyle]="{'color': '#23272f'}">Bienvenue sur le tableau de bord d'administration</h2>
    <p>Veuillez sélectionner une option ci-dessous.</p>
  </div>

  <!-- Options stylisées -->
  <div class="dashboard-options">
    <div class="option-card" (click)="selectSection('users')">
      <div class="option-icon">
        <!-- Icône utilisateur -->
        <svg width="32" height="32" fill="none" stroke="#1976d2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
          <circle cx="12" cy="8" r="4"/>
          <path d="M4 20c0-4 4-7 8-7s8 3 8 7"/>
        </svg>
      </div>
      <h3>Gestion des utilisateurs</h3>
      <p>Créer, modifier ou supprimer des utilisateurs.</p>
    </div>
    <div class="option-card" (click)="selectSection('admin')">
      <div class="option-icon">
        <!-- Icône admin/bouclier -->
        <svg width="32" height="32" fill="none" stroke="#1976d2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
          <path d="M12 2l7 4v6c0 5-3.5 9.74-7 10-3.5-0.26-7-5-7-10V6l7-4z"/>
          <circle cx="12" cy="10" r="3"/>
        </svg>
      </div>
      <h3>Coordonnées de l'admin</h3>
      <p>Voir et modifier les informations de l'administrateur.</p>
    </div>
  </div>

  <!-- Modale pour afficher le contenu sélectionné -->
  <div class="modal-overlay" *ngIf="selectedSection">
    <div class="modal-content-block" [ngClass]="{'admin-modal': selectedSection === 'admin'}">
      <button class="close-modal-btn" (click)="selectedSection = null">&times;</button>
      <ng-container *ngIf="selectedSection === 'users'">
        <!-- Bloc gestion des utilisateurs -->
        <div class="dashboard-block users-block">
          <h3>Gestion des utilisateurs</h3>
          <button class="create-btn" (click)="openCreate()">Créer un utilisateur</button>
          <table class="user-table">
            <thead>
              <tr>
                <th>Nom d'utilisateur</th>
                <th>Nom complet</th>
                <th>Email</th>
                <th>Numéro de téléphone</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of users">
                <td>{{user.username}}</td>
                <td>{{user.fullname}}</td>
                <td>{{user.email}}</td>
                <td>{{user.phone}}</td>
                <td>
                  <button class="action-btn" (click)="openEdit(user)">Modifier</button>
                  <button class="action-btn" (click)="confirmDelete(user)">Supprimer</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </ng-container>
      <ng-container *ngIf="selectedSection === 'admin'">
        <!-- Bloc coordonnées admin -->
        <div class="dashboard-block admin-block">
          <h3>Coordonnées de l'admin</h3>
          
          <div class="admin-info-display">
            <!-- Admin avatar -->
            <div class="admin-avatar">
              <svg width="54" height="54" fill="none" stroke="#1976d2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                <circle cx="12" cy="8" r="4"/>
                <path d="M4 20c0-4 4-7 8-7s8 3 8 7"/>
              </svg>
            </div>
            
            <div class="admin-role-badge">Super Admin</div>
            <h3 class="admin-name">{{ adminInfo?.fullname || 'Chargement...' }}</h3>
            <ul class="admin-info-list">
              <li><svg width="18" height="18" fill="none" stroke="#1976d2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" style="vertical-align:middle;margin-right:6px;"><path d="M16 21v-2a4 4 0 0 0-8 0v2"/><circle cx="12" cy="7" r="4"/></svg> <strong>Nom :</strong> {{ adminInfo?.fullname || 'Non renseigné' }}</li>
              <li><svg width="18" height="18" fill="none" stroke="#1976d2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" style="vertical-align:middle;margin-right:6px;"><path d="M4 4h16v16H4z"/><path d="M22 6l-10 7L2 6"/></svg> <strong>Email :</strong> {{ adminInfo?.email || 'Non renseigné' }}</li>
              <li><svg width="18" height="18" fill="none" stroke="#1976d2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" style="vertical-align:middle;margin-right:6px;"><path d="M22 16.92V19a2 2 0 0 1-2 2A19.72 19.72 0 0 1 3 5a2 2 0 0 1 2-2h2.09a2 2 0 0 1 2 1.72c.13.81.36 1.6.7 2.34a2 2 0 0 1-.45 2.11l-.27.27a16 16 0 0 0 6.29 6.29l.27-.27a2 2 0 0 1 2.11-.45c.74.34 1.53.57 2.34.7A2 2 0 0 1 22 16.92z"/></svg> <strong>Téléphone :</strong> {{ adminInfo?.phone || 'Non renseigné' }}</li>
            </ul>
            <button class="change-password-btn" (click)="openChangePasswordModal()">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" style="vertical-align:middle;margin-right:6px;"><rect x="3" y="11" width="18" height="10" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
              Modifier le mot de passe
            </button>
          </div>
        </div>
      </ng-container>
    </div>
  </div>

  <!-- Modal création/modification utilisateur -->
  <div class="modal" *ngIf="showForm">
    <div class="modal-content">
      <h3>{{isEdit ? 'Modifier' : 'Créer'}} un utilisateur</h3>
      <form (ngSubmit)="save()">
        <label>Nom d'utilisateur <span style="color: red;">*</span>
          <input type="text" required [(ngModel)]="formUser.username" name="username">
        </label>
        <label>Nom complet <span style="color: red;">*</span>
          <input type="text" required [(ngModel)]="formUser.fullname" name="fullname">
        </label>
        <label>Email <span style="color: red;">*</span>
          <input type="email" required [(ngModel)]="formUser.email" name="email">
        </label>
        <label>Téléphone (optionnel)
          <input type="text" [(ngModel)]="formUser.phone" name="phone" placeholder="Numéro de téléphone (optionnel)">
        </label>
        <label *ngIf="!isEdit">Mot de passe <span style="color: red;">*</span>
          <div class="password-input-wrapper">
            <input [type]="showPasswordField ? 'text' : 'password'" required [(ngModel)]="formUser.password" name="password" placeholder=" ">
            <span class="toggle-password" (click)="showPasswordField = !showPasswordField">
              <svg *ngIf="!showPasswordField" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#1976d2" stroke-width="2" viewBox="0 0 24 24"><ellipse cx="12" cy="12" rx="9" ry="5"/><circle cx="12" cy="12" r="2.5"/><line x1="3" y1="3" x2="21" y2="21" stroke="#1976d2" stroke-width="2"/></svg>
              <svg *ngIf="showPasswordField" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#1976d2" stroke-width="2" viewBox="0 0 24 24"><ellipse cx="12" cy="12" rx="9" ry="5"/><circle cx="12" cy="12" r="2.5"/></svg>
            </span>
          </div>
        </label>
        <!-- Suppression du champ Rôle -->
        <div class="modal-actions">
          <button type="submit">{{isEdit ? 'Enregistrer' : 'Créer'}}</button>
          <button type="button" (click)="cancel()">Annuler</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de changement de mot de passe admin -->
  <div class="modal" *ngIf="showChangePasswordModal">
    <div class="modal-content change-password-modal">
      <h3>Changer le mot de passe Admin</h3>
      <form (ngSubmit)="changeAdminPassword()">
        <label>Ancien mot de passe <span style="color: red;">*</span>
          <div class="password-input-wrapper">
            <input [type]="showOldPassword ? 'text' : 'password'" required [(ngModel)]="adminPassword.old" name="adminOldPassword" placeholder=" ">
            <span class="toggle-password" (click)="showOldPassword = !showOldPassword">
              <svg *ngIf="!showOldPassword" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#1976d2" stroke-width="2" viewBox="0 0 24 24"><ellipse cx="12" cy="12" rx="9" ry="5"/><circle cx="12" cy="12" r="2.5"/><line x1="3" y1="3" x2="21" y2="21" stroke="#1976d2" stroke-width="2"/></svg>
              <svg *ngIf="showOldPassword" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#1976d2" stroke-width="2" viewBox="0 0 24 24"><ellipse cx="12" cy="12" rx="9" ry="5"/><circle cx="12" cy="12" r="2.5"/></svg>
            </span>
          </div>
        </label>
        <label>Nouveau mot de passe <span style="color: red;">*</span>
          <div class="password-input-wrapper">
            <input [type]="showNewPassword ? 'text' : 'password'" required [(ngModel)]="adminPassword.new" name="adminNewPassword" placeholder=" ">
            <span class="toggle-password" (click)="showNewPassword = !showNewPassword">
              <svg *ngIf="!showNewPassword" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#1976d2" stroke-width="2" viewBox="0 0 24 24"><ellipse cx="12" cy="12" rx="9" ry="5"/><circle cx="12" cy="12" r="2.5"/><line x1="3" y1="3" x2="21" y2="21" stroke="#1976d2" stroke-width="2"/></svg>
              <svg *ngIf="showNewPassword" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#1976d2" stroke-width="2" viewBox="0 0 24 24"><ellipse cx="12" cy="12" rx="9" ry="5"/><circle cx="12" cy="12" r="2.5"/></svg>
            </span>
          </div>
        </label>
        <label>Confirmer le nouveau mot de passe <span style="color: red;">*</span>
          <div class="password-input-wrapper">
            <input [type]="showConfirmPassword ? 'text' : 'password'" required [(ngModel)]="adminPassword.confirm" name="adminConfirmPassword" placeholder=" ">
            <span class="toggle-password" (click)="showConfirmPassword = !showConfirmPassword">
              <svg *ngIf="!showConfirmPassword" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#1976d2" stroke-width="2" viewBox="0 0 24 24"><ellipse cx="12" cy="12" rx="9" ry="5"/><circle cx="12" cy="12" r="2.5"/><line x1="3" y1="3" x2="21" y2="21" stroke="#1976d2" stroke-width="2"/></svg>
              <svg *ngIf="showConfirmPassword" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#1976d2" stroke-width="2" viewBox="0 0 24 24"><ellipse cx="12" cy="12" rx="9" ry="5"/><circle cx="12" cy="12" r="2.5"/></svg>
            </span>
          </div>
        </label>
        <div class="modal-actions">
          <button type="submit">Valider</button>
          <button type="button" (click)="closeChangePasswordModal()">Annuler</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modale de confirmation de suppression -->
  <div class="modal-overlay" *ngIf="userToDelete">
    <div class="modal-content-block delete-modal-block">
      <h3 style="color:#d32f2f;"><span class="delete-icon" style="background:#ffeaea;"><svg width="24" height="24" fill="none" stroke="#d32f2f" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg></span>Confirmer la suppression</h3>
      <p>Voulez-vous vraiment supprimer l'utilisateur <strong>{{userToDelete.username}}</strong> ?<br>Cette action est <span style="color:#d32f2f;font-weight:600;">irréversible</span>.</p>
      <div class="modal-actions">
        <button type="button" (click)="cancelDelete()" class="cancel-btn">Annuler</button>
        <button type="button" (click)="deleteConfirmed()" class="delete-btn">Supprimer</button>
      </div>
    </div>
  </div>
</div> 